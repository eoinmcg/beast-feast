$={score:0,music:null,sfx:null,numPlayers:1,includeAI:!0,totals:{bluey:0,greeny:0,pinky:0,yelly:0},orientated:!1},$.Boot=function(t){},$.Boot.prototype={init:function(){var t=this._getMinMax();$.music=$.Helpers.getItem("music")||!1,$.sfx=$.Helpers.getItem("sfx")||!1,$.includeAI=$.Helpers.getItem("includeAI")||!1,$.Helpers.setItem($.music),$.Helpers.setItem($.sfx),$.Helpers.setItem($.includeAI),this.input.maxPointers=10,this.stage.disableVisibilityChange=!0,this.stage.smoothed=!1,this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.scale.setMinMax(t.w,t.h,t.maxW,t.maxH),this.scale.pageAlignHorizontally=!0,this.scale.pageAlignVertically=!0,this.scale.forceOrientation(!0,!1),this.scale.setResizeCallback(this.gameResized,this),this.scale.enterIncorrectOrientation.add(this.enterIncorrectOrientation,this),this.scale.leaveIncorrectOrientation.add(this.leaveIncorrectOrientation,this)},preload:function(){this.load.image("preloaderBar","a/loading.png")},create:function(){this.state.start("Preloader")},gameResized:function(t,e){var s=this._getMinMax();this.scale.setMinMax(s.w,s.h,s.maxW,s.maxH)},enterIncorrectOrientation:function(){$.orientated=!1,document.getElementById("orientation").style.display="block"},leaveIncorrectOrientation:function(){$.orientated=!0,document.getElementById("orientation").style.display="none"},_getMinMax:function(){var t={w:480,h:320};return t.ratio=t.h/t.w,t.maxH=window.innerHeight,t.maxW=t.maxH/t.ratio,t}},$.Preloader=function(t){this.background=null,this.preloadBar=null,this.ready=!1},$.Preloader.prototype={preload:function(){this.preloadBar=this.add.sprite(0,this.game.world.height/2,"preloaderBar"),this.load.setPreloadSprite(this.preloadBar),this.load.audio("titleMusic",["a/sfx/bugs.mp3"]),this.load.atlasJSONHash("bugs","a/bugs.png","a/bugs.json"),this.load.spritesheet("button","a/button.png",50,30),this.load.image("controls","a/controls.png"),this.load.audio("pop",["a/sfx/pop.mp3"]),this.load.audio("thud",["a/sfx/thud.mp3"]),this.load.audio("combo",["a/sfx/combo.mp3"]),this.load.audio("collect",["a/sfx/collect.mp3"]),this.load.bitmapFont("8bit","a/fat-and-tiny.png","a/fat-and-tiny.xml")},create:function(){this.preloadBar.cropEnabled=!1},update:function(){if(this.cache.isSoundDecoded("thud")&&this.ready===!1){this.ready=!0;var t=this.add.audio("combo");t.play(),this.state.start("Intro")}}},$.Helpers={getItem:function(t){var e;try{e=localStorage.getItem(t)}catch(s){e=!1}return"true"===e?!0:"false"===e?!1:e},setItem:function(t,e){try{localStorage.setItem(t,e)}catch(s){}}},$.Intro=function(t){},$.Intro.prototype={create:function(){var t,e,s,a=this,i=a.game,h=this.game.world.centerX;this.currentText="",this.introText=this.game.add.bitmapText(h,30,"8bit","eoinmcg",20),this.introText.tint=57906,this.introText.anchor.x=.5,this.introText.alpha=0,t=i.add.tween(this.introText).to({alpha:1},500,Phaser.Easing.Elastic.EaseInOut),this.introText2=this.game.add.bitmapText(h,50,"8bit","presents",30),this.introText2.tint=57906,this.introText2.anchor.x=.5,this.introText2.alpha=0,e=i.add.tween(this.introText2).to({alpha:1},500,Phaser.Easing.Elastic.EaseInOut),this.skull=this.game.add.sprite(h,120,"bugs","skull.png"),this.skull.anchor.x=.5,this.skull.scale.x=9,this.skull.scale.y=9,this.skull.alpha=0,s=i.add.tween(this.skull).to({alpha:1},2200,Phaser.Easing.Elastic.EaseInOut),this.game.scale.fullScreenScaleMode=Phaser.ScaleManager.EXACT_FIT,this.game.scale.startFullScreen(),this.button=i.add.button(0,0,"button",function(){a.showSplash(!0)},this,1,0,2),this.button.scale.x=20,this.button.scale.y=20,this.button.alpha=0,t.chain(e),t.start(),s.start(),this.timer=i.time.create(!1),this.timer.loop(3e3,function(){a.showSplash(!1)},this),this.timer.start()},showSplash:function(t){t=t||!1,t&&(this.game.scale.fullScreenScaleMode=Phaser.ScaleManager.EXACT_FIT,this.game.scale.startFullScreen()),this.state.start("Splash")},update:function(){var t=this.game.input.keyboard.addKey(Phaser.Keyboard.ENTER);t.isDown&&this.showSplash(!1)}},$.Splash=function(t){this.music=null},$.Splash.prototype={create:function(){var t=this.game,e=this,s=this.game.world.centerX;this.game.stage.backgroundColor="#000",this.gfx=this.game.add.graphics(),this.splat=t.add.sprite(s,120,"bugs","logo/logo_circle.png"),this.splat.anchor.x=.5,this.splat.anchor.y=.5,this.splat.scale.x=0,this.splat.scale.y=0,this.game.add.tween(this.splat.scale).to({y:2,x:2},1e3,Phaser.Easing.Elastic.Out).start(),this.title=t.add.sprite(s,60,"bugs","logo/logo_text.png"),this.title.anchor.x=.5,this.title.scale.x=0,this.title.scale.y=0,this.game.add.tween(this.title.scale).to({y:1.8,x:1.8},1200,Phaser.Easing.Elastic.Out).start(),this.help=t.add.button(40,10,"button",e.showHelp,this,3,3,3),this.help.anchor.x=.5,this.helpText=this.game.add.bitmapText(2,3,"8bit","HELP",18),this.helpText.anchor.x=.5,this.help.addChild(this.helpText),this.options=t.add.button(420,10,"button",e.showOptions,this,3,3,3),this.options.anchor.x=.5,this.optionsText=this.game.add.bitmapText(2,3,"8bit","OPTIONS",14),this.optionsText.anchor.x=.5,this.options.addChild(this.optionsText),this.button=t.add.button(s,500,"button",function(){e.startGame(!1)},this,1,0,2),this.button.anchor.x=.5,this.button.scale.x=1.5,this.button.scale.y=1.5,this.buttonText=this.game.add.bitmapText(2,3,"8bit","START",20),this.buttonText.anchor.x=.5,this.button.addChild(this.buttonText),this.game.add.tween(this.button).to({y:240},1700,Phaser.Easing.Elastic.Out).start()},startGame:function(t){t=t||!1,this.game.scale.fullScreenScaleMode=Phaser.ScaleManager.EXACT_FIT,this.game.scale.startFullScreen(),this.state.start("Select")},showHelp:function(){this.state.start("Help")},showOptions:function(){this.state.start("Options")},update:function(){var t=this.game.input.keyboard.addKey(Phaser.Keyboard.ENTER),e=this.game.input.keyboard.addKey(Phaser.Keyboard.S),s=this.game.input.keyboard.addKey(Phaser.Keyboard.H),a=this.game.input.keyboard.addKey(Phaser.Keyboard.O);e.isDown||t.isDown?this.startGame():s.isDown?this.showHelp():a.isDown&&this.showOptions()}},$.Help=function(t){},$.Help.prototype={create:function(){var t,e,s=this.game,a=this;e=this.game.world.centerX,this.game.stage.backgroundColor="#000",this.title=this.game.add.bitmapText(e,10,"8bit","HOW TO PLAY",40),this.title.anchor.x=.5,this.title.tint=14708619,t=this.game.add.sprite(315,70,"bugs","worm.png"),t.scale.x=1.5,t.scale.y=1.5,t=this.game.add.bitmapText(e,60,"8bit","EAT THE WORM",25),t.anchor.x=.5,t=.5,t=this.game.add.bitmapText(e,80,"8bit","HIT BOTH KEYS TO DASH",25),t.anchor.x=.5,t=.5,t=this.game.add.sprite(20,170,"bugs","bluey/head_0.png"),t.scale.x=2.5,t.scale.y=2.5,t.anchor.y=.5,t.angle=-90,t=this.game.add.bitmapText(50,150,"8bit","BLUEY",20),t.tint=2731519,t=this.game.add.bitmapText(140,150,"8bit","cursors",20),t.tint=2731519,t=this.game.add.sprite(300,170,"bugs","greeny/head_0.png"),t.scale.x=2.5,t.scale.y=2.5,t.anchor.y=.5,t.angle=-90,t=this.game.add.bitmapText(330,150,"8bit","GREENY",20),t.tint=57906,t=this.game.add.bitmapText(420,150,"8bit","Z, X",20),t.tint=57906,t=this.game.add.sprite(300,220,"bugs","yelly/head_0.png"),t.scale.x=2.5,t.scale.y=2.5,t.anchor.y=.5,t.angle=-90,t=this.game.add.bitmapText(330,200,"8bit","YELLY",20),t.tint=16770855,t=this.game.add.bitmapText(420,200,"8bit","N, M",20),t.tint=16770855,t=this.game.add.sprite(20,220,"bugs","pinky/head_0.png"),t.scale.x=2.5,t.scale.y=2.5,t.anchor.y=.5,t.angle=-90,t=this.game.add.bitmapText(50,200,"8bit","PINKY",20),t.tint=16711757,t=this.game.add.bitmapText(140,200,"8bit","Q, W",20),t.tint=16711757,this.back=s.add.button(e,250,"button",a.goBack,this,3,3,3),this.back.anchor.x=.5,this.back.scale.x=1.5,this.back.scale.y=1.5,this.backText=this.game.add.bitmapText(2,3,"8bit","BACK",18),this.backText.anchor.x=.5,this.back.addChild(this.backText)},goBack:function(){this.state.start("Splash")},update:function(){var t=this.game.input.keyboard.addKey(Phaser.Keyboard.ENTER),e=this.game.input.keyboard.addKey(Phaser.Keyboard.ESC),s=this.game.input.keyboard.addKey(Phaser.Keyboard.B);(s.isDown||t.isDown||e.isDown)&&this.state.start("Splash")}},$.Options=function(t){},$.Options.prototype={create:function(){var t,e,s=this.game,a=this;e=this.game.world.centerX,this.game.stage.backgroundColor="#000",this.title=this.game.add.bitmapText(e,10,"8bit","OPTIONS",40),this.title.anchor.x=.5,this.buttons=[],t=this.game.add.bitmapText(150,100,"8bit","SFX",25),t=.5,this.buttons.sfx=s.add.button(110,100,"button",function(){a.toggleItem("sfx"),a.updateButton("sfx")},this,3,3,3),this.buttons.sfx.anchor.x=.5,this.buttons.sfxText=this.game.add.bitmapText(2,3,"8bit","OFF",20),this.buttons.sfxText.anchor.x=.5,this.buttons.sfx.addChild(this.buttons.sfxText),a.updateButton("sfx"),t=this.game.add.bitmapText(150,150,"8bit","MUSIC",25),t=.5,this.buttons.music=s.add.button(110,150,"button",function(){a.toggleItem("music"),a.updateButton("music")},this,3,3,3),this.buttons.music.anchor.x=.5,this.buttons.musicText=this.game.add.bitmapText(2,3,"8bit","OFF",20),this.buttons.musicText.anchor.x=.5,this.buttons.music.addChild(this.buttons.musicText),a.updateButton("music"),t=this.game.add.bitmapText(150,200,"8bit","CPU",25),t=.5,this.buttons.includeAI=s.add.button(110,200,"button",function(){a.toggleItem("includeAI"),a.updateButton("includeAI")},this,3,3,3),this.buttons.includeAI.anchor.x=.5,this.buttons.includeAIText=this.game.add.bitmapText(2,3,"8bit","OFF",20),this.buttons.includeAIText.anchor.x=.5,this.buttons.includeAI.addChild(this.buttons.includeAIText),a.updateButton("includeAI"),this.back=s.add.button(e,250,"button",a.goBack,this,3,3,3),this.back.anchor.x=.5,this.back.scale.x=1.5,this.back.scale.y=1.5,this.backText=this.game.add.bitmapText(2,3,"8bit","BACK",18),this.backText.anchor.x=.5,this.back.addChild(this.backText)},update:function(){var t=this.game.input.keyboard.addKey(Phaser.Keyboard.ENTER),e=this.game.input.keyboard.addKey(Phaser.Keyboard.ESC),s=this.game.input.keyboard.addKey(Phaser.Keyboard.B);(s.isDown||t.isDown||e.isDown)&&this.state.start("Splash")},goBack:function(){this.state.start("Splash")},toggleItem:function(t,e){var s=$.Helpers.getItem(t);return e=e||!s,$.Helpers.setItem(t,e),console.log(t,e,$.Helpers.getItem(t)),$[t]=e,e},updateButton:function(t){var e=$[t];e?(text="ON",tint=57906):(text="OFF",tint=16751360),this.buttons[t+"Text"].text=text,this.buttons[t+"Text"].tint=tint}},$.Select=function(t){$.music=null,$.numPlayers=null},$.Select.prototype={create:function(){var t,e=this.game,s=this;t=this.game.world.centerX,this.keys={k1:e.input.keyboard.addKey(Phaser.Keyboard.ONE),k2:e.input.keyboard.addKey(Phaser.Keyboard.TWO),k3:e.input.keyboard.addKey(Phaser.Keyboard.THREE),k4:e.input.keyboard.addKey(Phaser.Keyboard.FOUR)},this.game.stage.backgroundColor="#000",this.title=this.game.add.bitmapText(t,10,"8bit","SELECT NUMBER OF PLAYERS ",30),this.title.anchor.x=.5,this.title.tint=14708619,this.button1up=e.add.button(-200,70,"button",s.game1up,this,1,0,2),this.button1up.scale.x=1.5,this.button1up.scale.y=1.5,this.button1up.addChild(e.add.bitmapText(5,3,"8bit","1",20)),this.button1up.addChild(this.makeHead(60,20,"bluey")),this.game.add.tween(this.button1up).to({x:100},300,Phaser.Easing.Elastic.EaseInOut).start(),this.button2up=e.add.button(-400,120,"button",s.game2up,this,1,0,2),this.button2up.scale.x=1.5,this.button2up.scale.y=1.5,this.button2up.addChild(e.add.bitmapText(5,3,"8bit","2",20)),this.button2up.addChild(this.makeHead(60,20,"bluey")),this.button2up.addChild(this.makeHead(80,20,"greeny")),this.game.add.tween(this.button2up).to({x:100},400,Phaser.Easing.Elastic.EaseInOut).start(),Phaser.Device.desktop&&(this.button3up=e.add.button(-600,170,"button",s.game3up,this,1,0,2),this.button3up.scale.x=1.5,this.button3up.scale.y=1.5,this.button3up.addChild(e.add.bitmapText(5,3,"8bit","3",20)),this.button3up.addChild(this.makeHead(60,20,"bluey")),this.button3up.addChild(this.makeHead(80,20,"greeny")),this.button3up.addChild(this.makeHead(100,20,"pinky")),this.game.add.tween(this.button3up).to({x:100},500,Phaser.Easing.Elastic.EaseInOut).start(),this.button4up=e.add.button(-600,220,"button",s.game4up,this,1,0,2),this.button4up.scale.x=1.5,this.button4up.scale.y=1.5,this.button4up.addChild(e.add.bitmapText(5,3,"8bit","4",20)),this.button4up.addChild(this.makeHead(60,20,"bluey")),this.button4up.addChild(this.makeHead(80,20,"greeny")),this.button4up.addChild(this.makeHead(100,20,"pinky")),this.button4up.addChild(this.makeHead(120,20,"yelly")),this.game.add.tween(this.button4up).to({x:100},500,Phaser.Easing.Elastic.EaseInOut).start())},update:function(){var t=this.game.input.keyboard.addKey(Phaser.Keyboard.ESC);t.isDown&&this.state.start("Splash"),this.keys.k1.isDown?this.game1up():this.keys.k2.isDown?this.game2up():this.keys.k3.isDown?this.game3up():this.keys.k4.isDown&&this.game4up()},game1up:function(){$.numPlayers=1,this.state.start("GetReady")},game2up:function(){$.numPlayers=2,this.state.start("GetReady")},game3up:function(){$.numPlayers=3,this.state.start("GetReady")},game4up:function(){$.numPlayers=4,this.state.start("GetReady")},makeHead:function(t,e,s){var a,i=this.game;return a=i.add.sprite(t,e,"bugs",s+"/head_0.png"),a.scale.x=2,a.scale.y=2,a.animations.add("bite",[s+"/head_0.png",s+"/head_1.png"],4,!0),a.animations.play("bite",[0,1]),a.angle=-90,a}},$.GetReady=function(t){this.music=null},$.GetReady.prototype={create:function(){this.game,this.game.world.centerX;this.game.stage.backgroundColor="#000"},init:function(){var t,e=this.game;e.stage.backgroundColor="343635",this.background=this.game.add.sprite(0,0,"bugs","bg.png"),this.background.scale.x=2,this.background.scale.y=2,this.overlay=this.game.add.sprite(0,0,"bugs","bg.png"),this.overlay.scale.x=2,this.overlay.scale.y=2,this.overlay.tint=0,this.overlay.alpha=1;this.game.add.tween(this.overlay).to({alpha:0},1e3,Phaser.Easing.Elastic.EaseInOut).start();this.intro=this.game.add.bitmapText(this.game.world.centerX,this.game.world.centerY,"8bit","GET READY!",60),this.intro.anchor.x=.5,this.intro.anchor.y=.5,this.intro.scale.x=0,this.intro.scale.y=0,t=this.game.add.tween(this.intro.scale).to({x:1,y:1},1500,Phaser.Easing.Elastic.EaseInOut).start(),t.onComplete.add(function(){this.state.start("Game")}.bind(this))},update:function(){}},$.Game=function(t){},$.Game.prototype={create:function(){var t=this.game;this.scale=2,this.gameTime=30,this.includeAI=$.includeAI,this.introPlaying=!0,this.totals=$.totals,this.tints={bluey:2731519,greeny:57906,pinky:16711757,yelly:16770855},window.t=this,this.shakeWorld=0,this.gameOver=!1,$.music&&(this.music=this.game.add.audio("titleMusic"),this.music.play()),t.input.addPointer(),t.input.addPointer(),t.input.addPointer(),t.input.addPointer(),this.sfx={combo:this.game.add.audio("combo"),collect:this.game.add.audio("collect"),pop:this.game.add.audio("pop"),thud:this.game.add.audio("thud")},this.init()},init:function(){var t=this.game,e=this;if(t.border=27,this.timer=t.time.create(!1),this.timer.loop(1e3*this.gameTime,function(){e.gameOverSequence()},this),this.timer.start(),t.stage.backgroundColor="343635",this.background=this.game.add.sprite(0,0,"bugs","bg.png"),this.background.scale.x=this.scale,this.background.scale.y=this.scale,this.emitter=this.makeEmitter(),this.game.bones=t.add.group(),this.game.heads=t.add.group(),this.game.bodies=t.add.group(),this.game.foods=t.add.group(),this.explosions=t.add.group(),this.points=t.add.group(),this.worm=new $.Food(t,{scale:this.scale,parent:this}),this.game.foods.add(this.worm),this.makePlayers(),this.scores=[],this.scores.p1=this.game.add.bitmapText(10,-5,"8bit","0",30),this.scores.p1.tint=2731519,this.scores.p2=this.game.add.bitmapText(t.world.width-30,-5,"8bit","0",30),this.scores.p2.tint=57906,this.scores.p3=this.game.add.bitmapText(10,t.world.height-30,"8bit","0",30),this.scores.p3.tint=16711757,this.scores.p4=this.game.add.bitmapText(t.world.width-30,t.world.height-30,"8bit","0",30),this.scores.p4.tint=16770855,this.controls=[],!Phaser.Device.desktop){this.controls[0]=t.add.button(0,0,"controls"),this.controls[0].scale.x=2,this.controls[0].scale.y=2,this.controls[0].onInputUp.add(e.p1LeftUp,this),this.controls[0].onInputDown.add(e.p1LeftDown,this),this.controls[1]=t.add.button(0,320,"controls"),this.controls[1].scale.x=2,this.controls[1].scale.y=-2,this.controls[1].onInputUp.add(e.p1RightUp,this),this.controls[1].onInputDown.add(e.p1RightDown,this),this.controls[2]=t.add.button(240,0,"controls"),this.controls[2].scale.x=2,this.controls[2].scale.y=2,this.controls[2].onInputUp.add(e.p2LeftUp,this),this.controls[2].onInputDown.add(e.p2LeftDown,this),this.controls[3]=t.add.button(240,320,"controls"),this.controls[3].scale.x=2,this.controls[3].scale.y=-2,this.controls[3].onInputUp.add(e.p2RightUp,this),this.controls[3].onInputDown.add(e.p2RightDown,this);for(var s=0;s<this.controls.length;s+=1)t.add.tween(this.controls[s]).to({alpha:0},500,Phaser.Easing.Elastic.EaseInOut).start()}this.countdownShadow=this.game.add.bitmapText(t.world.centerX+2,4,"8bit","",50),this.countdownShadow.anchor.x=.5,this.countdownShadow.tint=0,this.countdown=this.game.add.bitmapText(t.world.centerX,2,"8bit","",50),this.countdown.anchor.x=.5,this.countdown.tint=16777215},reset:function(){for(var t=(this.game,this.game.heads.children),e=t.length;e--;)t[e].reset()},update:function(){var t,e,s=this.game,a=0,i=this.game.heads.children,h=i.length;for(this.gameOver&&(t=this.game.input.keyboard.addKey(Phaser.Keyboard.ENTER),e=this.game.input.keyboard.addKey(Phaser.Keyboard.Q),t.isDown?this.restartGame():e.isDown&&this.state.start("Splash")),s.physics.arcade.overlap(this.game.heads,this.game.foods,this.eatFood,null,this),s.physics.arcade.overlap(this.game.heads,this.game.bodies,this.hitBody,null,this),s.physics.arcade.overlap(this.game.heads,this.game.heads,this.hitHead,null,this);h--;)this.scores[i[h].player].text=i[h].score.toString(),i[h].killed&&(a+=1);a===i.length-1,this.doShakeWorld(),this.countdown.text=~~(this.timer.duration/1e3),this.countdownShadow.text=this.countdown.text,this.debug&&this._debug(),this.game.input.keyboard.addKey(Phaser.Keyboard.P).isDown&&this._screenshot()},render:function(){},gameOverSequence:function(){var t,e=this.game,s=this.game.heads.children,a=0,i="",h="",o="",n=s.length;if($.music&&this.music.stop(),!this.gameOver){for(;n--;)s[n].score>a&&(a=s[n].score,i=s[n].col,h=s[n].col),s[n].moveBody("stop");o=this.tints[i],this.totals[i]+=1;var r=this.game.add.sprite(0,0,"bugs","bg.png");r.scale.x=this.scale,r.scale.y=this.scale,r.tint=0,r.alpha=0;this.game.add.tween(r).to({alpha:.5},1e3,Phaser.Easing.Elastic.EaseInOut).start();i=i.toString().toUpperCase()+" WINS",this.gameOver=!0,this.winnerText=this.game.add.bitmapText(e.world.centerX,e.world.height+200,"8bit",i,72),this.winnerText.tint=o,this.winnerText.anchor.x=.5,t=this.game.add.tween(this.winnerText).to({y:0},1e3,Phaser.Easing.Elastic.EaseInOut).start(),t.onComplete.add(function(){var t;this.victor=this.game.add.sprite(this.game.world.centerX-25,270,"bugs",h+"/head_0.png"),this.victor.animations.add("laugh",[h+"/head_0.png",h+"/head_1.png"],10,!0),this.victor.anchor.x=.5,this.victor.scale.x=6,this.victor.scale.y=5,this.victor.angle=-110,this.victor.animations.play("laugh"),t=this.game.add.tween(this.victor).to({angle:-80},400,Phaser.Easing.Elastic.EaseInOut,!0,1e3,!0),t.repeat(10,500),this.showScoreSummaries()}.bind(this)),window.setTimeout(function(){this.buttonRestart=e.add.button(40,500,"button",this.restartGame,this,3,3,3),this.buttonRestart.scale.x=2,this.buttonRestart.scale.y=1.5,tmp=e.add.bitmapText(5,3,"8bit","Replay",16),this.buttonRestart.addChild(tmp),this.game.add.tween(this.buttonRestart).to({y:260},1e3,Phaser.Easing.Elastic.Out).start()}.bind(this),1e3),window.setTimeout(function(){var t;this.buttonReset=e.add.button(340,500,"button",this.resetGame,this,3,3,3),this.buttonReset.scale.x=2,this.buttonReset.scale.y=1.5,this.buttonReset.tint=12764103,t=e.add.bitmapText(11,3,"8bit","Quit",16),this.buttonReset.addChild(t),this.game.add.tween(this.buttonReset).to({y:260},1e3,Phaser.Easing.Elastic.Out).start()}.bind(this),1200),this.countdown.kill(),this.countdownShadow.kill()}},restartGame:function(){this.state.start("GetReady")},resetGame:function(){$.totals={bluey:0,greeny:0,pinky:0,yelly:0},this.state.start("Splash")},makeThud:function(t,e,s,a){var i=this.explosions.create(t,e,"bugs","thud/00.png");i.anchor.setTo(.5,.5),i.reset(t,e),i.scale.x=s,i.scale.y=s,i.animations.add("thud",["thud/00.png","thud/01.png","thud/02.png","thud/03.png","thud/04.png","thud/05.png","thud/06.png","thud/07.png"]),i.play("thud",30,!1,!0),a&&($.sfx&&this.sfx.thud.play(),this.shakeWorld=30)},showPoint:function(t,e,s){var a,i,h=this.points.create(t,e,"bugs","ui/point.png");h.anchor.setTo(.5,.5),h.reset(t,e),h.scale.x=2,h.scale.y=2,h.tint=this.tints[s],a=this.game.add.tween(h).to({y:e-50},500,Phaser.Easing.Elastic.EaseInOut),i=this.game.add.tween(h).to({alpha:0},300,Phaser.Easing.Elastic.EaseInOut),a.chain(i),a.start()},eatFood:function(t,e){e.alive=!1,e.spawn(),this.particleBurst(t.body.x,t.body.y,5),this.showPoint(t.body.x,t.body.y,t.col),t.munch(),t.score+=1},hitBody:function(t,e){e.player===t.col&&2!=e.scale.x||e.id>0&&!e.dead&&t.invincibility<0&&(t.speed=0,t.die(),e.player!==t.col&&(this.awardKill(e.player),this.showPoint(t.x,t.y,e.player),console.log(e)))},hitHead:function(t,e){t.col!==e.col&&(t.speed=0,t.die(),e.speed=0,e.die())},awardKill:function(t){for(var e=this.game,s=e.heads.children,a=s.length;a--;)s[a].col===t&&(s[a].kills+=1,s[a].score+=1)},doShakeWorld:function(){if(this.shakeWorld>0){var t=this.game.rnd.integerInRange(-5,5),e=this.game.rnd.integerInRange(-5,5);this.game.world.setBounds(t,e,this.game.width+t,this.game.height+e),this.shakeWorld--,0===this.shakeWorld&&this.game.world.setBounds(0,0,this.game.width,this.game.height)}},particleBurst:function(t,e,s){this.emitter.x=t,this.emitter.y=e,s=s||20,this.emitter.start(!0,500,null,s)},makeEmitter:function(){var t,e=300,s=this.game;return t=s.add.emitter(0,0,200),t.makeParticles("bugs","frag.png"),t.gravity=0,t.minParticleSpeed.setTo(-e,-e),t.maxParticleSpeed.setTo(e,e),t.lifespan=1e3,t.minParticleScale=2,t.maxParticleScale=3,t.minRotation=0,t.maxRotation=0,t.maxParticleScale=1,t.forEach(function(t){t.tint=16742312}),t},makePlayers:function(){var t,e=this.game;t=new $.Bug(e,{scale:this.scale,parent:this,col:"bluey",player:"p1",x:e.border,y:e.border,controls:1,hex:2731519,angle:45}),this.game.heads.add(t),t=$.numPlayers>1?new $.Bug(e,{scale:this.scale,parent:this,col:"greeny",player:"p2",x:e.world.width-e.border,y:e.border,controls:2,angle:180}):new $.Bug(e,{scale:this.scale,parent:this,col:"greeny",player:"p2",x:e.world.width-e.border,y:e.border,cpu:1,angle:180}),this.game.heads.add(t),$.numPlayers>=3?(t=new $.Bug(e,{scale:this.scale,parent:this,col:"pinky",player:"p3",x:e.border,y:e.world.height-e.border,controls:3,angle:0}),this.game.heads.add(t)):this.includeAI&&(t=new $.Bug(e,{scale:this.scale,parent:this,col:"pinky",player:"p3",x:e.border,y:e.world.height-e.border,cpu:1,angle:0}),this.game.heads.add(t)),4===$.numPlayers?(t=new $.Bug(e,{scale:this.scale,parent:this,col:"yelly",player:"p4",x:e.world.width-e.border,y:e.world.height-e.border,controls:4,angle:225}),this.game.heads.add(t)):this.includeAI&&(t=new $.Bug(e,{scale:this.scale,parent:this,col:"yelly",player:"p4",x:e.world.width-e.border,y:e.world.height-e.border,cpu:1,angle:225}),this.game.heads.add(t))},p1LeftDown:function(){this.game.heads.children[0].forceLeft=!0},p1LeftUp:function(){this.game.heads.children[0].forceLeft=!1},p1RightDown:function(){this.game.heads.children[0].forceRight=!0},p1RightUp:function(){this.game.heads.children[0].forceRight=!1},p2LeftDown:function(){this.game.heads.children[1].forceLeft=!0},p2LeftUp:function(){this.game.heads.children[1].forceLeft=!1},p2RightDown:function(){this.game.heads.children[1].forceRight=!0},p2RightUp:function(){this.game.heads.children[1].forceRight=!1},showScoreSummaries:function(){var t,e,s=100,a=Object.keys(this.totals),i=this.game.heads.hash,h=function(t){var e,s=!1;for(e=0;e<i.length;e+=1)i[e].col===t&&(s=!0);return s};for(this.winsText=this.game.add.bitmapText(this.game.world.centerX,70,"8bit","Victories",40),this.winsText.anchor.x=.5,this.talliesText=[],e=0;e<a.length;e+=1)h(a[e])&&(t=this.totals[a[e]].toString(),this.talliesText.push(this.game.add.bitmapText(this.game.world.centerX,s,"8bit",t,40)),this.talliesText[this.talliesText.length-1].anchor.x=.5,this.talliesText[this.talliesText.length-1].tint=this.tints[a[e]],s+=30)},_screenshot:function(){var t=document.getElementsByTagName("canvas")[0],e=new XMLHttpRequest,s=t.toDataURL("image/png"),a="img="+s;e.open("POST","img.php",!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){4==e.readyState&&200==e.status&&console.log("saved img"+e.responseText)},e.send(a)}},$.Bug=function(t,e){e=e||{},e.col=e.col||"pinky",this.opts=e,this.wins=0,this.score=0,this.kills=0,this.killed=!1,this.forceLeft=!1,this.forceLeft=!1,this.forceRight=!1,this.game=t,this._p=e.parent,this.size=e.scale,this.player=e.player,this.col=e.col,Phaser.Sprite.call(this,t,e.x,e.y,"bugs",this.col+"/head_0.png"),this.animations.add("head",[this.col+"/head_0.png",this.col+"/head_1.png"],4,!0),this.animations.add("head_stop",[this.col+"/head_0.png"],10,!0),this.animations.play("head"),t.physics.enable(this,Phaser.Physics.ARCADE),this.scale.x=e.scale,this.scale.y=e.scale,this.angle=e.angle,this.anchor.setTo(.5,.5),this.body.collideWorldBounds=!0,this.parts=[],this.partsOffset=this.width,this.moves=[],this.speed=100,this.isCpu=e.cpu||!1,this.brain={},this.munchCounter=!1,this.init(),1===e.controls?this.controls={left:this.game.input.keyboard.addKey(Phaser.Keyboard.LEFT),right:this.game.input.keyboard.addKey(Phaser.Keyboard.RIGHT)}:2===e.controls?this.controls={left:this.game.input.keyboard.addKey(Phaser.Keyboard.Z),right:this.game.input.keyboard.addKey(Phaser.Keyboard.X)}:3===e.controls?this.controls={left:this.game.input.keyboard.addKey(Phaser.Keyboard.N),right:this.game.input.keyboard.addKey(Phaser.Keyboard.M)}:4===e.controls&&(this.controls={left:this.game.input.keyboard.addKey(Phaser.Keyboard.Q),right:this.game.input.keyboard.addKey(Phaser.Keyboard.W)})},$.Bug.prototype=Object.create(Phaser.Sprite.prototype),$.Bug.prototype.constructor=$.Bug,$.Bug.prototype.init=function(){var t;for(this.speed=2,this.turningCircle=5,this.angle=this.opts.angle,this.invincibility=50,this.parts=[],this.moves=[],t=0;2>t;t+=1)this.addPart(t)},$.Bug.prototype.munch=function(){var t;this.alive&&(this.munchCounter===!1&&(this.munchCounter=1),this._p.sfx.collect.play(),this.parts[this.munchCounter-1]&&(this.parts[this.munchCounter-1].isMunching=!0,t=this.game.add.tween(this.parts[this.munchCounter-1].scale),t.to({x:[4,2],y:[4,2]},50,Phaser.Easing.Linear.InOut),t.onComplete.add(function(){this.alive&&this.parts[this.munchCounter-1]&&(this.parts[this.munchCounter-1].isMunching=!1,this.munchCounter>=this.parts.length-1?(this.munchCounter=!1,this.addPart()):(this.munchCounter+=1,this.munch()))}.bind(this),this),t.start()))},$.Bug.prototype.addPart=function(){var t,e=this.game;t=e.bodies.create(-20,-20,"bugs",this.col+"/body_0.png"),t.animations.add("body",[this.col+"/body_0.png",this.col+"/body_1.png"],10,!0),t.animations.add("body_munch",[this.col+"/body_munch.png"],10,!0),t.animations.add("stop",[this.col+"/body_1.png"],10,!0),t.animations.add("tail",[this.col+"/tail.png"]),t.hidden=!1,t.scale.x=this.scale.x,t.scale.y=this.scale.y,t.anchor.setTo(.5,.5),t.id=this.parts.length,t.player=this.col,t.isMunching=!1,e.physics.enable(t,Phaser.Physics.ARCADE),this.parts.push(t)},$.Bug.prototype.update=function(){var t,e,s,a,i,h,o=this;this.game;return o._p.gameOver?void this.animations.play("head_stop"):(o.body.velocity.x=0,o.body.velocity.y=0,o.isCpu?(h=o.getCpuMove(),a=h.left,i=h.right):o.invincibility<-5&&(a=o.controls.left.isDown||o.forceLeft,i=o.controls.right.isDown||o.forceRight),a&&i?o.boost=!0:a?o.angle-=o.turningCircle:i&&(o.angle+=o.turningCircle),t=o.angle*Math.PI/180,e=Math.cos(t)*o.speed,s=Math.sin(t)*o.speed,o.x+=e,o.y+=s,o.moves.push({x:o.x,y:o.y,a:o.angle}),o.boost&&(o.x+=e,o.y+=s,o.moves.push({x:o.x,y:o.y,a:o.angle})),o.moveBody(),o.checkBounds(),o.boost=!1,o.invincibility-=1,void(o.invincibility>0?o.alpha=.5:o.alpha=1))},$.Bug.prototype.moveBody=function(t){var e,s=this,a=t?"stop":"body";for(e=0;e<s.parts.length;e+=1)pos=s.moves[s.moves.length-(e+1)*s.width/(s.boost?s.speed:s.speed)],pos&&s.parts[e].hidden===!1&&(s.parts[e].x=pos.x,s.parts[e].y=pos.y,s.parts[e].angle=pos.a,e===s.parts.length-1?s.parts[e].animations.play("tail",60,!0):s.parts[e].isMunching?s.parts[e].animations.play("body_munch"):s.parts[e].animations.play(a))},$.Bug.prototype.die=function(){var t,e,s,a,i,h=this;h.dead?"_dead":"";for(this.alive=!1,this.justKilled=!0,this.deadX=this.x,this.deadY=this.y,h._p.makeThud(h.x,h.y,3,!0),i=h.game.bones.create(this.x,this.y,"bugs",this.col+"/bone_head.png"),i.scale.x=h.opts.scale,i.angle=h.angle,i.scale.y=h.opts.scale,i.alpha=1,i.anchor.setTo(.5,.5),i.tint=5592405,a=0;a<h.parts.length;a+=1)e=h.parts[a].x,s=h.parts[a].y,t=a===h.parts.length-1?["bone_tail"]:["bone_body"],i=h.game.bones.create(h.parts[a].x,h.parts[a].y,"bugs",this.col+"/"+t+".png"),i.scale.x=h.opts.scale,i.angle=h.parts[a].angle,i.scale.y=h.opts.scale,i.alpha=1,i.tint=5592405,i.anchor.setTo(.5,.5),h._p.makeThud(h.parts[a].x,h.parts[a].y,4*Math.random(),!1),h.parts[a].hidden=!0,h.parts[a].moves=[],h.game.bodies.remove(h.parts[a],!0),h.game.world.remove(h.parts[a].res);this.timesKilled+=1,this.kill(),h.parts=[],h.moves=[],window.setTimeout(function(){this.reset(this.opts.x,this.opts.y),this.init()}.bind(this),1e3)},$.Bug.prototype.checkBounds=function(){var t=this.game,e=t.world.width,s=t.world.height,a=t.border;return this.killed?!0:(this.x>e-a?this.x=e-a:this.x<a&&(this.x=a),void(this.y>s-a?this.y=s-a:this.y<a&&(this.y=a)))},$.Bug.prototype.getCpuMove=function(){var t={l:0,r:0};return this.brain.canAccelerate=!0,this.brain.target?t=this.seekTarget():this.brain.target=this.findTarget(),t},$.Bug.prototype.findTarget=function(){return this._p.worm},$.Bug.prototype.seekTarget=function(){this.brain.target=this.findTarget();var t,e=this.game.physics.arcade.angleBetween(this,this.brain.target),s=0,a=0,i=60;return e=~~(e*(180/Math.PI)),t=e-this.angle,this.brain.canAccelerate&&t>-1&&1>t?(s=1,a=1):e<this.angle?s=1:e>this.angle&&(a=1),this.y<i&&(this.x<i?(s=0,a=1):(s=1,a=0)),this.y>this.game.world.height-i&&(this.x<i?(s=1,a=0):(s=0,a=1)),{left:s,right:a}},$.Food=function(t,e){var s;e=e||{},this.game=t,this.opts=e,this._p=e.parent,this.scale=e.scale,s=Phaser.Sprite.call(this,t,t.world.centerX,t.world.centerY,"bugs","worm.png"),this.scale.x=e.scale,this.scale.y=e.scale,this.anchor.setTo(.5,.5),t.physics.enable(this,Phaser.Physics.ARCADE),this.name="food",this.tick=0},$.Food.prototype=Object.create(Phaser.Sprite.prototype),$.Food.prototype.constructor=$.Food,$.Food.prototype.update=function(){this.tick%18===0&&(this.scale.x*=-1),this.tick+=1},$.Food.prototype.spawn=function(){var t=this.game;this.x=~~(Math.random()*(t.world._width-100))+50,this.y=~~(Math.random()*(t.world._height-100))+50};var game=new Phaser.Game(480,320,Phaser.CANVAS,"game");game.state.add("Boot",$.Boot),game.state.add("Preloader",$.Preloader),game.state.add("Intro",$.Intro),game.state.add("Splash",$.Splash),game.state.add("Options",$.Options),game.state.add("Help",$.Help),game.state.add("Select",$.Select),game.state.add("GetReady",$.GetReady),game.state.add("Game",$.Game),game.state.start("Boot");